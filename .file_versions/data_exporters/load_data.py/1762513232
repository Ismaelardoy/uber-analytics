if 'data_exporter' not in globals():
    from mage_ai.data_preparation.decorators import data_exporter
if 'test' not in globals():
    from mage_ai.data_preparation.decorators import test

import shutil
import os

@data_exporter
def export_data(data, *args, **kwargs):
    """
    Carga final del pipeline.
    Copia el archivo Parquet transformado a la carpeta de salida definitiva.
    """
    src_path = data.get('data_path')
    dest_path = '/home/src/final_data/transformed_data.parquet'  # puedes cambiarlo

    # Crear carpeta destino si no existe
    os.makedirs(os.path.dirname(dest_path), exist_ok=True)

    # Copiar archivo al destino
    shutil.copy(src_path, dest_path)

    print(f"âœ… Archivo final copiado a: {dest_path}")

    return {'final_path': dest_path}


@test
def test_output(output, *args) -> None:
    assert output is not None, 'The output is undefined'
    assert 'final_path' in output, 'Expected key final_path missing'



