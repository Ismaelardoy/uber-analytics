if 'data_loader' not in globals():
    from mage_ai.data_preparation.decorators import data_loader
if 'test' not in globals():
    from mage_ai.data_preparation.decorators import test

import sys
sys.path.append('src')
from etl.ingest_zone import ingest_zonedata

@data_loader
def load_data(*args, **kwargs):
    """
    Template code for loading data from any source.

    Returns:
        Anything (e.g. data frame, dictionary, array, int, str, etc.)
    """
    # Specify your data loading logic here

    df = ingest_zonedata()

    return {'pyspark_df': df}

@test
def test_output(output, *args) -> None:
    """
    Test that the output contains a valid PySpark DataFrame.
    """
    assert output is not None, 'The output is undefined'
    assert 'pyspark_df' in output, 'Expected key pyspark_df missing'
    df = output['pyspark_df']
    # Verificar que realmente sea un DataFrame de Spark
    from pyspark.sql import DataFrame
    assert isinstance(df, DataFrame), 'Output is not a PySpark DataFrame'
